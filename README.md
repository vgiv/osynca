# osynca

"Набор программных модулей" (далее, для краткости, просто "программа") OSYNCA ("Осинка") предназначен для синхронизации файлов на двух компьютерах с их переносом на сменном носителе (далее - "флешке"). Программа должна работать под Windows (XP, 7, 8, 10), для её работы также нужен архиватор 7z.

# Файлы

* osynca.exe - exe-файл для создания списков синхронизируемых файлов;
* osynca.ini - файл конфигурации для программы osynca;
* init.bat - bat-файл для первичной настройки пакета;
* put.bat0 - тепмплейт bat-файла для рутинной отправки файлов с данного компьютера на удалённый;
* get.bat0 - тепмплейт bat-файла для рутинного получения файлов на данный компьютер с удалённого;
* put.ico - иконка для файла put.bat;
* get.ico - иконка для файла get.bat.

# Схема работы

Программа создаёт и поддерживает на каждом из компьютеров список файлов, выбранных для синхронизации, с датами их последней модификации. При синхронизации файлов программа переносит с одного компьютера на другой новые файлы, файлы, имеющие более свежие даты модификации, а также удаляет на втором компьютере файлы, удалённые на первом. Удалённые файлы, а также старые версии модифицированных, сохраняются в бэкапах, что даёт возможность при необходимости откатить изменения.

Таким образом, предлагается следующая схема работы:
* работа с файлами (изменение, удаление, создание) на первом компьютере;
* перенос синхронизируемых файлов на второй компьютер;
* работа с файлами (изменение, удаление, создание) на втором компьютере;
* перенос синхронизируемых файлов на первый компьютер.

Программа не сможет разобраиться в ситуации, при которой файлы будут одновременно изменяться на обоих компьютерах.

В силу специфики средств реализации синхронизируемые каталоги на обоих компьютерах должны иметь одинаковые названия и находиться  на одноименных логических дисках.

Программа также не умеет создавать новые пустые и удалять старые опустевшие каталоги. Для решения этой проблемы можно использовать костыли, описанные ниже (см. remove_empty_dirs.bat).

# Первичная настройка

* Убедиться, что в систему установлен архиватор 7z.
* Скопировать файлы из каталога binary в рабочий каталог первого компьютера (например, c:\OSYNCA\).
* В файле osynca.ini задать следующие параметры (в квадратных скобках - значения в приведенном в качестве примера файле):
 * COMPUTER1 - имя первого компьютера [HOME];
 * OMPUTER2 - имя второго компьютера [WORK];
 * DIRECTION - направление синхронизации ( для первого компьютера должно быть 12) [12];
 * SDIR - "каталог синхронизации" для хранения списков синхронизации на флешке [Z:\OSYNCA\SYNC\];
 * DIR0, DIR1, ..., DIR99 - каталоги для синхронизации [D:\DIR0\, D:\DIR1\, ..., D:\DIR99\].
* Можно (но не обязательно) поменять в том же файле следующие пераметры:
 * DTIME - максимальная разность времён модификации файлов в секундах, при котором они считаются одинаковыми [3];
 * EDLISTNAME - имя bat-файла для удаления пустых каталогов [remove_empty_dirs.bat];
 * EDPREFIX - команда для удаления пустых каталогов [rd /q].
* Запустить init.bat на первом компьютере. В рабочем каталоге будут созданы каталог BACKUP, файлы put.bat и get.bat. В каталоге %SDIR% будет создан список файлов файлов %COMPUTER1%.fil.
* Скопировать файлы osynca.exe, osynca.ini, put.bat0, get.bat0 в рабочий каталог второго компьютера.
* Поменять в файде osynca.ini значение переменной DIRECTION на 21.
* Запустить init.bat на втором компьютере.  В рабочем каталоге будут созданы каталог BACKUP, файлы put.bat и get.bat. В каталоге %SDIR% создан список файлов %COMPUTER2%.fil.

# Рутинная процедура синхроницации

* Работать за первым компьютером
* Запустить put.bat на первом компьютере
* Перенести флешку на второй компьютер
* Запустить get.bat на первом компьютере
* Работать за вторым компьютером
* И т.д.

Как уже было сказано, каталоги, удалённые на одном компьютере, на другом автоматически не удаляются, а пустые каталоги, созданные на одном компьютере, на другом не создаются. Для удаления ВСЕХ пустых каталогов из списка синхронизации вручную предназначен автоматически генерируемый файл remove_empty_dirs.bat, который можно периодически запускать (или игнорировать, если выс не волнует наличие на двух компьютерах деревьев каталогов с несинхронизированными пустыми "листьями"). Если вы не хотите удаления каких-то пустых каталогов и/или их корректной синхронизации - создавайте в них, например, файлы-плейсхолдер нулевойы длины.
