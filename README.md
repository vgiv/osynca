# osynca

Скрипт OSYNCA предназначен для синхронизации файлов на двух (или более) компьютерах с их переносом на сменном носителе (далее - "флешке"). Скрипт должен работать под Windows (XP, 7, 8, 10), для его работы также нужен архиватор 7z.

# Файлы

В состав скрипта входят следующие файлы:

* init.bat - bat-файл для первичной синхронизации файлов
* put.bat - bat-файл для рутинной отправки файлов с данного компьютера на удалённый
* get.bat - bat-файл для рутинного получения файлов на данный компьютер с удалённого
* osynca.exe - exe-файл для создания списков синхронизируемых файлов
* osynca.ini - файл конфигурации для программы osynca
* put.ico - иконка для файла put.bat
* get.ico - иконка для файла get.bat

# Схема работы

Скрипт создаёт и поддерживает на каждом из компьютеров список файлов, выбранных для синхронизации, с датами их последней модификации. При синхронизации файлов скрипт переносит с одного компьютера на другой новые файлы, файлы, имеющие более свежие даты модификации, а также удаляет на втором компьютере файлы, удалённые на первом. Удалённые файлы, а также старые версии модифицированных, сохраняются в бэкапах, что даёт возможность при необходимости откатить изменения.

Таким образом, предполагается следующая схема работы пользователя:
* работа с файлами (изменение, удаление, создание) на первом компьютере
* перенос синхронизируемых файлов на второй компьютер
* работа с файлами (изменение, удаление, создание) на втором компьютере
* перенос синхронизируемых файлов на первый компьютер

Скрипт не сможет разобраиться в ситуации, если в период между сессиями синхронизации файлы будут одновременно изменяться на обоих компьютерах.

В силу специфики средств реализации синхронизируемые каталоги на обоих компьютерах должны иметь одинаковые названия (хотя могут находиться на разных логических дисках, см. ниже параметры VOLUME и RVOLUME)

Скрипт также не умеет создавать новые пустые и удалять старые опустевшие каталоги. Для решения этой проблемы можно использовать костыли, описанные ниже (см. remove_empty_dirs.bat).

# Первичная настройка скрипта

* Убедиться, что в систему установлен архиватор 7z.
* Скопировать файлы из каталога binary в любые каталоги первого и второго компьютеров.
* В файлах osynca.ini на обоих компьютерах, при необходимости, изменить следующие параметры (в квадратных скобках - значения в приведенном в качестве примера файле): Computer - имя данного компьютера [home], RemoteComputer - имя удалённого компьютера [work], SDIR - "каталог синхронизации" для хранения списков синхронизации на флешке [Z:\OSYNCA\SYNC\], BDIR - каталог для хранения бэкапов [D:\OSYNCA\BACKUP\], DTIME - максимальная разность времён модификации файлов в секундах, при котором они считаются одинаковыми [3], EDLISTNAME - имя bat-файла для удаления пустых каталогов [remove_empty_dirs.bat], EDPREFIX - команда для удаления пустых каталогов [rd /q], VOLUME - буква логического диска синхронизируемых каталогов на данном компьютере (с двоеточием; параметр не нужен, если на обоих компьютерах синхронизируемые файлы находятся на логическом диске с одним именем) [], VOLUME - то же для удалённого компьютера, DIR0, DIR1, ..., DIR99 - каталоги для синхронизации [D:\DIR0\, D:\DIR1\, ..., D:\DIR99\].
* В файле put.bat первого компьютера, при необходимости, изменить следующие параметры: DIRECTION - направление синхронизации [12], COMPUTER1 - имя первого компьютера [home], COMPUTER2 - имя второго компьютера [work], SDIR - каталог синхронизации [Z:\OSYNCA\SYNC\]
* В файле get.bat первого компьютера, при необходимости, изменить следующие параметры: DIRECTION - направление синхронизации [12], COMPUTER1 - имя первого компьютера [home], COMPUTER2 - имя второго компьютера [work], SDIR - каталог синхронизации [Z:\OSYNCA\SYNC\], BDIR1 - каталог бэкапа для первого компьютера [D:\OSYNCA\BACKUP\], BDIR2 - то же для второго компьютера [D:\OSYNCA\BACKUP\], VOLUME1 - буква логического диска с синхронизируемыми файлами для первого компьютера [D:], VOLUME2 - то же для второго компьютера [D:].
* Скопировать put.bat и get.bat из каталога скрипта первого компьютера в каталог скринта второго, заменив в них DIRECTION=12 на DIRECTION=21.
* Запустить init.bat на обоих компьютерах (при этом в каталоге %SDIR% создадуться списки файлов %COMPUTER1%.fil и %COMPUTER2%.fil).

# Рутинная процедура синхроницации

* Работать за первым компьютером
* Запустить put.bat на первом компьютере
* Перенести флешку на второй компьютер
* Запустить get.bat на первом компьютере
* Работать за вторым компьютером
* И т.д.

Как уже было сказано, каталоги, удалённые на одном компьютере, на другом автоматически не удаляются, а пустые каталоги, созданные на одном компьютере, на другом не создаются. Для удаления ВСЕХ пустых каталогов из списка синхронизации вручную предназначен автоматически генерируемый файл remove_empty_dirs.bat, который можно периодически запускать (или игнорировать, если выс не волнует наличие на двух компьютерах деревьев каталогов с несинхронизированными пустыми "листьями"). Если вы не хотите удаления каких-то пустых каталогов и/или их корректной синхронизации - создавайте в них, например, файлы-плейсхолдер нулевойы длины.
